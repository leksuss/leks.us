---
title: Конечный автомат как механизм контроля состояний
date: 2023-05-22T17:22:00+03:00
draft: true
---

Программисты часто сталкиваются с таким понятием, как **состояние**. Некоторые книги по говорят, что состояние в программировании - чуть ли не самая важная вещь, о которой вам необходимо думать при написании программ.
### Итак, что же такое состояние? Что оно означает и почему это важно?

Состояние - это все данные вашей программы в определенный момент её работы. Если вы поменяете данные (любую переменную, значение поля любого объекта), вы поменяете состояние. Большинство программ имеют очень большое количество состояний. Идеальная программа (в теории) должна иметь только два состояния: 
 - в начале своего исполнения
 - в конце своего исполнения

Почему же нам следует избегать большого количества состояний? Потому что большинство ошибок происходит, когда происходит смена одного состояния на другое. Теперь мы приходим к такому концепту как конечный автомат (FSM, Finite State Machine)

### Конечный автомат


**Конечный автомат** - это паттерн, при котором у вас есть некоторое конечное и относительно небольшое количество состояний и правил перехода между этими состояниями. Собственно, это всё. В каждый момент времени ваши данные (ваша программа) должна быть в одном из описанных состояний. И дальше, если что-то происходит (например: пользователь кликает на кнопку, или программа получает сообщение, или скрипт получает данные из базы данных), скрипт, работающий в парадигме конечного автомата проверяет эти изменения. И определяет, достаточны ли они для того, чтобы поменять состояние или нет. 

Вы можете думать о конечном автомате как о графе, где состояния это вершины, и вы прыгаете между этими состояниями в зависимости от изменений, которые к вам приходят снаружи. Таким образом, вы полностью контролируете состояния своей программы, причем эти состояния полностью описаны. Всё многообразие состояний обычной программы вы схлопываете до небольшого их числа в конечном автомате.

Кажется, что это очень хороший паттерн, и у него только одни плюсы. Но нет, не каждый бизнес-процесс можно разложить на четкие и однозначные состояния, с однозначными и строгими правилами перехода между ними. Помимо этого, есть сложные программы, со сложной бизнес-логикой, где сама доменная область подразумевает огромное число состояний, и вы не можете их уменьшить. Но в тех случаях, когда это все же возможно, конечный автомат - отличный помощник в уменьшении сложности программы.