---
title: "Custom QuerySet method in Django"
date: 2023-04-07T23:48:00+03:00
draft: true
---
Ребят, подскажите, в чем отличие на практике кастомного менеджера от кастомного метода в queryset? В каких случаях какой использовать? Я смотрю на них и как будто это одно и то же, просто сделанное разными способами. Пока нашел отличие, что в метод queryset можно еще добавлять параметры, например, запрашивать разные role, а не хардкодить одну роль.
```python
# Custom Manager
class AuthorManager(models.Manager):
    def get_queryset(self):
        return super().get_queryset().filter(role='Author')

# Custom QuerySet method
class AuthorQuerySet(models.QuerySet):
    def authors(self):
        return self.filter(role='Author')

class Person(models.Model):
    name = models.CharField()
    role = models.CharField()
    
    # register Custom Manager
    authors = AuthorManager()
    
    # register Custom QuerySet
    objects = AuthorQuerySet.as_manager()

# usage Custom Manager
People.authors.all()

# usage Custom QuerySet method
People.objects.authors()
```


В общем, после некоторого ресерча у меня появилось несколько утверждений. Буду рад, если кто-то их подтвердит/опровергнет/уточнит.

1. До версии 1.7 (вроде бы) можно было только кастомные менеджеры делать, после добавили кастомные методы, и поэтому функционал частично пересекается.

2. Кастомный менеджер более фундаментальная вещь, используется когда у нас ограниченный небольшой набор подмножеств, которым удобно дать отдельное имя, и которые однозначно и логично выделяются из множества, и не предназначены для изменения в будущем. Пример выше с выделением из Person подгруппы Author довольно наглядно и удобно использовать. Впрочем, мы могли бы создать абстрактный класс Person и от него наследовать Author, или создать OneToOne связь между Person и Author. Что лучше? Мне пока не ясно.

3. Кастомный менеджер не предполагает использование аргументов, тогда как в метод можно передать и уточнить QuerySet. 

4. В большинстве случаев кастомный метод возвращает QuerySet, то есть, его можно ипользовать в цепочке QuerySet, а кастомный менеджер так использовать не получится. 

Кастомный кверисет метод - более гибкий инструмент, куда можно передавать параметры и использовать в различных частях проекта для сокращения сложности кода. 
Кастомный менеджер мне показался просто способом более удобного нейминга менеджера запросов с дополнительным фильтром.


Да, похоже на то, в первом пункте отметил это. Единственный плюс, это что названия получаются более релевантными и короче чем у кастомных QuerySet за счет "переименования" objects:
Person.authors.all()
VS
Person.objects.authors()

Евгений Евсеев, [08.04.2023 18:52]
Менеджеры запросов в Django похожи на легаси. Не видел пока ни одной ситуации, где кастомный менеджер лучше кастомного QuerySet. Поэтому вообще не ясно зачем нужны сразу две сущности, если можно было обойтись одной.

Евгений Евсеев, [08.04.2023 18:55]
Когда-то давно в старой версии Django простого способа переопределить QuerySet не существовало, поэтому приходилось мучаться с менеджерами. Сейчас это исправили, жизнь наладилась)